# Sound Implementation

## Overview

The Space Invaders sound system has been implemented using the `rodio` audio library. The original arcade machine had 9 distinct sound effects triggered by writing to hardware ports 3 and 5.

## Sound Ports

### Port 3 (0x03)
- **Bit 0**: UFO sound (continuous tone while bit is high)
- **Bit 1**: Player shot
- **Bit 2**: Player explosion/death
- **Bit 3**: Invader explosion
- **Bit 4**: Extended play (extra ship awarded)

### Port 5 (0x05)
- **Bit 0**: Fleet movement 1 (196 Hz)
- **Bit 1**: Fleet movement 2 (164 Hz)
- **Bit 2**: Fleet movement 3 (146 Hz)
- **Bit 3**: Fleet movement 4 (130 Hz)
- **Bit 4**: UFO hit

## Implementation Details

### Sound Generation
All sounds are synthesized using simple waveforms:
- **Square waves**: Used for tones with constant frequency
- **Frequency sweeps**: Used for explosion sounds (descending pitch)

### Architecture
- `SoundSystem` struct manages all sound playback
- Tracks state of both sound ports (port 3 and port 5)
- Detects rising edges on port bits to trigger sounds
- Uses `rodio::Sink` for each sound channel
- Supports up to 10 simultaneous sounds

### Volume Levels
Sounds are mixed at different volumes to prevent clipping:
- Fleet movement: 0.15 (quieter, repetitive)
- Player shot: 0.2
- Invader die: 0.2
- Extended play: 0.2
- UFO: 0.3
- Player die: 0.3
- UFO hit: 0.3

### Integration
The sound system is updated once per frame (60 Hz) in the main loop:
1. CPU writes to ports 3 and 5 during instruction execution
2. At end of frame, `SoundSystem::update()` is called
3. Rising edge detection triggers appropriate sounds
4. Sounds play asynchronously without blocking emulation

## Differences from Original

The original Space Invaders used analog circuits and discrete components for sound generation. This implementation uses digital synthesis to approximate those sounds:

- Original sounds were generated by analog oscillators and filters
- This implementation uses simple square waves and linear frequency sweeps
- The approximation captures the essence of the sounds but may not be bit-perfect
- Timing is based on port write detection rather than analog circuit behavior

## Future Improvements

Potential enhancements:
- Sample-based playback using recordings from actual hardware
- More accurate waveform synthesis (sawtooth, triangle waves)
- Sound mixing with authentic arcade volume levels
- Recording/playback of game audio
